<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Player with HLS, DASH, and DRM</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <style>
    body { margin: 0; background: #000; color: #fff; font-family: sans-serif; }
    #player { width: 100%; max-height: 50vh; background: #000; }
    #channelList { display: flex; overflow-x: auto; background: #111; }
    .channel { padding: 10px; cursor: pointer; white-space: nowrap; }
    .channel:hover { background: #333; }
  </style>
</head>
<body>
  <video id="player" controls autoplay></video>
  <div id="channelList"></div>

  <script>
    const video = document.getElementById('player');
    const channelList = document.getElementById('channelList');

    const playlist = `#EXTINF:-1 tvg-logo="https://i.imgur.com/pTpe0Qn.jpeg" group-title="PH CHANNELSðŸ‡µðŸ‡­",4K TRAVEL
https://streams2.sofast.tv/sofastplayout/33c31ac4-51fa-46ae-afd0-0d1fe5e60a80_0_HLS/master.m3u8
#EXTINF:-1 tvg-logo="https://i.imgur.com/hVdhGtP.jpeg" group-title="PH CHANNELSðŸ‡µðŸ‡­",A2Z/ABS CBN
#KODIPROP:inputstream.adaptive.license_type=clearkey
#KODIPROP:inputstream.adaptive.license_key=f703e4c8ec9041eeb5028ab4248fa094:c22f2162e176eee6273a5d0b68d19530
https://qp-pldt-live-grp-02-prod.akamaized.net/out/u/cg_a2z.mpd`;

    const channels = [];
    const lines = playlist.split('\n');
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].startsWith('#EXTINF')) {
        const title = lines[i].split(',')[1];
        const logo = lines[i].match(/tvg-logo="(.*?)"/)?.[1];
        let licenseKey = null;
        let j = i + 1;
        while (j < lines.length && lines[j].startsWith('#')) {
          if (lines[j].includes('license_key')) {
            licenseKey = lines[j].split('=')[1];
          }
          j++;
        }
        const url = lines[j];
        channels.push({ title, logo, url, licenseKey });
        i = j;
      }
    }

    channels.forEach((channel, index) => {
      const div = document.createElement('div');
      div.className = 'channel';
      div.innerHTML = channel.logo
        ? `<img src="${channel.logo}" height="30" /><br>${channel.title}`
        : channel.title;
      div.onclick = () => playChannel(channel);
      channelList.appendChild(div);
    });

    function playChannel(channel) {
      if (window.hls) { window.hls.destroy(); }
      video.pause();
      video.src = '';

      if (channel.url.endsWith('.m3u8')) {
        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(channel.url);
          hls.attachMedia(video);
          window.hls = hls;
        } else {
          video.src = channel.url;
        }
      } else if (channel.url.endsWith('.mpd')) {
        const player = dashjs.MediaPlayer().create();
        player.initialize(video, channel.url, true);

        if (channel.licenseKey) {
          const [keyId, key] = channel.licenseKey.split(':');
          player.setProtectionData({
            'org.w3.clearkey': {
              clearkeys: { [keyId]: key }
            }
          });
        }
      } else {
        video.src = channel.url;
      }
    }

    // Autoplay first channel
    if (channels.length) playChannel(channels[0]);
  </script>
</body>
</html>
