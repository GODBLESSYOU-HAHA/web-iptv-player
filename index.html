<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IPTV Player - GOD BLESS YOU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://vjs.zencdn.net/8.5.2/video-js.css" rel="stylesheet" />
  <style>
    body { margin: 0; font-family: sans-serif; background: #111; color: #fff; }
    #player { width: 100%; max-height: 60vh; }
    #controls { display: flex; gap: 10px; padding: 10px; background: #222; flex-wrap: wrap; align-items: center; }
    #category-filter, #search-bar { padding: 6px 10px; font-size: 14px; border-radius: 4px; }

    .carousel-container {
      overflow-x: auto;
      display: flex;
      scroll-behavior: smooth;
      padding: 10px;
      gap: 10px;
      background: #000;
    }

    .channel {
      min-width: 200px;
      flex: 0 0 auto;
      background: #222;
      border-radius: 8px;
      padding: 10px;
      color: #fff;
      cursor: pointer;
      text-align: center;
      border: 2px solid transparent;
      position: relative;
    }

    .channel:hover {
      border-color: #0af;
      background: #333;
    }

    .channel img {
      max-width: 100%;
      height: 80px;
      object-fit: contain;
      border-radius: 4px;
      margin-bottom: 5px;
    }

    .channel strong {
      display: block;
      font-size: 15px;
      margin-bottom: 2px;
    }

    .channel small {
      font-size: 12px;
      color: #ccc;
    }

    .favorite-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: transparent;
      border: none;
      color: gold;
      font-size: 20px;
      cursor: pointer;
    }

    .now-playing {
      padding: 10px;
      background: #0af;
      color: #000;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
    }

    .now-playing img {
      height: 40px;
      width: 40px;
      object-fit: contain;
      border-radius: 4px;
      background: #fff;
    }
  </style>
</head>
<body>

  <video id="player" class="video-js vjs-default-skin" controls autoplay preload="auto"></video>

  <div class="now-playing" id="now-playing" style="display: none;">
    <img id="now-logo" src="" alt="Logo" />
    <span id="now-title">Now Playing</span>
  </div>

  <div id="controls">
    <label for="category-filter">Category:</label>
    <select id="category-filter"></select>
    
    <label for="search-bar">Search:</label>
    <input type="text" id="search-bar" placeholder="Search channel..." />
  </div>

  <div id="channel-carousel" class="carousel-container"></div>

  <script src="https://vjs.zencdn.net/8.5.2/video.min.js"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-dash@2/dash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-http-streaming@2.9.1/dist/videojs-http-streaming.min.js"></script>

  <script>
    const m3uUrl = "https://raw.githubusercontent.com/GODBLESSYOU-HAHA/FREEIPTV/refs/heads/main/GOD%20BLESS%20YOU";
    const player = videojs('player');
    let allChannels = [];
    let filteredChannels = [];
    let currentIndex = 0;

    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

    async function fetchM3U(url) {
      const res = await fetch(url);
      const text = await res.text();
      const lines = text.split('\n');
      const parsed = [];

      for (let i = 0; i < lines.length; i++) {
        if (lines[i].startsWith('#EXTINF')) {
          const nameMatch = lines[i].match(/,(.*)/);
          const groupMatch = lines[i].match(/group-title="(.*?)"/);
          const logoMatch = lines[i].match(/tvg-logo="(.*?)"/);

          parsed.push({
            name: nameMatch ? nameMatch[1].trim() : 'Unknown',
            group: groupMatch ? groupMatch[1] : 'General',
            logo: logoMatch ? logoMatch[1] : '',
            url: lines[i + 1]
          });
        }
      }

      return parsed;
    }

    function saveFavorites() {
      localStorage.setItem('favorites', JSON.stringify(favorites));
    }

    function toggleFavorite(channel) {
      const index = favorites.findIndex(f => f.url === channel.url);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        favorites.push(channel);
      }
      saveFavorites();
      renderCarousel(filteredChannels);
    }

    function isFavorite(channel) {
      return favorites.some(f => f.url === channel.url);
    }

    function updateNowPlaying(channel) {
      const banner = document.getElementById('now-playing');
      const logo = document.getElementById('now-logo');
      const title = document.getElementById('now-title');

      logo.src = channel.logo || '';
      title.textContent = channel.name;
      banner.style.display = 'flex';
    }

    function playStream(index) {
      const channel = filteredChannels[index];
      if (!channel) return;
      currentIndex = index;

      if (channel.url.endsWith('.m3u8')) {
        player.src({ src: channel.url, type: 'application/x-mpegURL' });
      } else if (channel.url.endsWith('.mpd')) {
        player.src({ src: channel.url, type: 'application/dash+xml' });
      } else {
        alert("Unsupported stream type.");
      }

      player.play();
      updateNowPlaying(channel);
    }

    function renderCategories() {
      const select = document.getElementById('category-filter');
      const groups = [...new Set(allChannels.map(c => c.group))];
      select.innerHTML = `<option value="All">All Categories</option>` +
        groups.map(g => `<option value="${g}">${g}</option>`).join('');
      select.onchange = filterChannels;
    }

    function filterChannels() {
      const selectedGroup = document.getElementById('category-filter').value;
      const searchTerm = document.getElementById('search-bar').value.toLowerCase();

      filteredChannels = allChannels.filter(c => {
        const matchGroup = selectedGroup === 'All' || c.group === selectedGroup;
        const matchName = c.name.toLowerCase().includes(searchTerm);
        return matchGroup && matchName;
      });

      renderCarousel(filteredChannels);
    }

    function renderCarousel(list) {
      const container = document.getElementById('channel-carousel');
      container.innerHTML = '';
      list.forEach((channel, index) => {
        const div = document.createElement('div');
        div.className = 'channel';
        div.innerHTML = `
          <button class="favorite-btn" title="Toggle Favorite">
            ${isFavorite(channel) ? '★' : '☆'}
          </button>
          ${channel.logo ? `<img src="${channel.logo}" alt="logo">` : ''}
          <strong>${channel.name}</strong>
          <small>${channel.group}</small>
        `;
        div.onclick = () => playStream(index);
        div.querySelector('.favorite-btn').onclick = (e) => {
          e.stopPropagation();
          toggleFavorite(channel);
        };
        container.appendChild(div);
      });

      if (list.length > 0) {
        playStream(0);
      }
    }

    // ← / → key navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') {
        currentIndex = (currentIndex + 1) % filteredChannels.length;
        playStream(currentIndex);
      } else if (e.key === 'ArrowLeft') {
        currentIndex = (currentIndex - 1 + filteredChannels.length) % filteredChannels.length;
        playStream(currentIndex);
      }
    });

    document.getElementById('search-bar').addEventListener('input', filterChannels);

    async function init() {
      allChannels = await fetchM3U(m3uUrl);
      renderCategories();
      filterChannels(); // Triggers initial rendering
    }

    init();
  </script>
</body>
</html>
