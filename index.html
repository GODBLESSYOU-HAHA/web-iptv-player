<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IPTV Web Player</title>
  <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
  <style>
    body { font-family: sans-serif; background: #111; color: white; margin: 0; padding: 0; }
    header { padding: 1rem; text-align: center; background: #222; }
    #player-container { position: sticky; top: 0; background: black; z-index: 10; }
    #channelList { display: flex; flex-wrap: nowrap; overflow-x: auto; padding: 1rem; gap: 1rem; }
    .channel { background: #222; padding: 1rem; border-radius: 10px; cursor: pointer; min-width: 200px; }
    .channel:hover { background: #333; }
    #nowPlaying { padding: 0.5rem 1rem; background: #333; }
    .controls { padding: 1rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }
    select, input { padding: 0.5rem; border-radius: 5px; border: none; }
    .favorite { color: gold; font-weight: bold; margin-left: 0.5rem; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>IPTV PREMIUM</h1>
  </header>

  <div id="player-container">
    <video id="video" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="300"></video>
    <div id="nowPlaying">Now Playing: <span id="nowPlayingTitle">None</span></div>
  </div>

  <div class="controls">
    <select id="categoryFilter">
      <option value="All">All Categories</option>
    </select>
    <input type="text" id="search" placeholder="Search channel...">
  </div>

  <div id="channelList"></div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

  <script>
    const m3uUrl = "https://raw.githubusercontent.com/GODBLESSYOU-HAHA/FREEIPTV/refs/heads/main/GOD%20BLESS%20YOU";
    const player = videojs('video');
    let channels = [], favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

    async function loadM3U() {
      const res = await fetch(m3uUrl);
      const text = await res.text();
      const lines = text.split('\n');
      let current = {};

      for (let line of lines) {
        if (line.startsWith("#EXTINF")) {
          const name = line.split(",").pop().trim();
          const match = line.match(/group-title="(.*?)"/);
          const group = match ? match[1] : "Other";
          current = { name, group };
        } else if (line.startsWith("http")) {
          current.url = line.trim();
          channels.push({ ...current });
        }
      }

      renderChannels();
      populateCategories();
    }

    function populateCategories() {
      const select = document.getElementById("categoryFilter");
      const categories = ["All", ...new Set(channels.map(c => c.group))];
      for (let cat of categories) {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      }
    }

    function renderChannels() {
      const container = document.getElementById("channelList");
      container.innerHTML = "";
      const search = document.getElementById("search").value.toLowerCase();
      const category = document.getElementById("categoryFilter").value;

      const filtered = channels.filter(c => {
        return (category === "All" || c.group === category) && c.name.toLowerCase().includes(search);
      });

      for (let ch of filtered) {
        const div = document.createElement("div");
        div.className = "channel";
        div.innerHTML = `
          ${ch.name}
          <span class="favorite" onclick="toggleFavorite('${ch.name}')">
            ${favorites.includes(ch.name) ? '⭐' : '☆'}
          </span>
        `;
        div.onclick = () => playStream(ch);
        container.appendChild(div);
      }
    }

    function playStream(channel) {
      document.getElementById("nowPlayingTitle").textContent = channel.name;
      const url = channel.url;

      console.log("Attempting to play:", url);

      if (url.includes(".m3u8")) {
        player.src({ src: url, type: "application/x-mpegURL" });
      } else if (url.includes(".mpd")) {
        player.src({ src: url, type: "application/dash+xml" });
      } else {
        player.src({ src: url, type: "application/x-mpegURL" }); // Try anyway
      }

      player.play();
    }

    function toggleFavorite(name) {
      if (favorites.includes(name)) {
        favorites = favorites.filter(n => n !== name);
      } else {
        favorites.push(name);
      }
      localStorage.setItem("favorites", JSON.stringify(favorites));
      renderChannels();
    }

    document.getElementById("categoryFilter").onchange = renderChannels;
    document.getElementById("search").oninput = renderChannels;

    loadM3U();
  </script>
</body>
</html>
